plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 15, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.43, l = 2, unit = "cm"))
)
world_map <- map_data("world")
count.map <- left_join(world.data, world_map, by = "region")
ggplot(data = count.map, aes(x = long, y = lat, group = group))+
geom_polygon(aes(fill = study.count))+
theme_void()+
scale_fill_viridis_c()+
theme(
text = element_text(color = "#22211d"),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = c(0.9, 0.5),
plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 15, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.43, l = 2, unit = "cm"))
)
ggplot(data = count.map, aes(x = long, y = lat, group = group))+
geom_polygon(aes(fill = study.count), colour = "white")+
theme_void()+
scale_color_gradient2(trans = "log", breaks=c(1,5,10,20,50,100) ) +
theme(
text = element_text(color = "#22211d"),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = c(0.9, 0.5),
plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 15, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.43, l = 2, unit = "cm"))
)
ggplot(data = count.map, aes(x = long, y = lat, group = group))+
geom_polygon(aes(fill = study.count), colour = "white")+
theme_void()+
scale_fill_viridis_c(trans = "log", breaks=c(1,5,10,20,50,100) ) +
theme(
text = element_text(color = "#22211d"),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = c(0.9, 0.5),
plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 15, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.43, l = 2, unit = "cm"))
)
ggplot(data = count.map, aes(x = long, y = lat, group = group))+
geom_polygon(aes(fill = study.count), colour = "white")+
theme_void()+
scale_fill_viridis_c(option = "rocket",
trans = "log", breaks=c(1,5,10,20,50,100) ) +
theme(
text = element_text(color = "#22211d"),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = c(.9, 0.5),
plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 15, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.43, l = 2, unit = "cm"))
)
ggplot(data = count.map, aes(x = long, y = lat, group = group))+
geom_polygon(aes(fill = study.count), colour = "white")+
theme_void()+
scale_fill_viridis_c(option = "rocket",
trans = "log", breaks=c(1, 3, 5, 7, 9, 11),
name ="Study count", guide = guide_legend(keyheight = unit(8, units = "mm"), keywidth = unit(32, "mm"), label.position = "bottom", title.position = 'top', nrow=6) ) +
theme(
text = element_text(color = "#22211d"),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = c(.15, 0.35),
plot.title = element_text(size= 40, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 40, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.43, l = 2, unit = "cm"))
)
ggplot(data = count.map, aes(x = long, y = lat, group = group))+
geom_polygon(aes(fill = study.count), colour = "white")+
theme_void()+
scale_fill_viridis_c(option = "rocket",
trans = "log", breaks=c(1, 3, 5, 7, 9, 11),
name ="Study count", guide = guide_legend(keyheight = unit(8, units = "mm"), keywidth = unit(32, "mm"), label.position = "bottom", title.position = 'top', nrow=6) ) +
theme(
text = element_text(color = "#22211d"),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = c(.15, 0.35),
plot.title = element_text(size= 40, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 40, hjust=0.01, color = "#4e4d47", margin = margin(b = 0.5, t = 0.43, l = 2, unit = "cm"))
)
View(data.general)
install.packages("venneuler")
library(rJava)
library(venneuler)
install.packages("rJava")
library(rJava)
install.packages("ggVennDiagram")
library(ggVennDiagram)
x <- list(A = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47),
B = c(47, 48, 55), c = c(47, 48, 49))
## ggVennDiagram ####
ggVennDiagram(x)
?ggVennDiagram()
ggVennDiagram(x,
label_alpha = 0,
color = "gray28",
lwd = 0.8, lty = 1,
label = "count",
category.names = c("External validation",
"Internal validation",
"Development")) +
scale_fill_gradient(low = "lightcyan", high = "deepskyblue4") +
guides(fill = guide_legend(title = "Title")) +
theme(legend.title = element_text(color = "gray28"),
legend.position = "bottom")
ggVennDiagram(x, category.names = c("External validation",
"Internal validation",
"Development"))
ggVennDiagram(x, color = "black", lwd = 0.8, lty = 1) +
scale_fill_gradient(low = "#F4FAFE", high = "#4981BF")
ggVennDiagram(x,
label_size = 9,
set_size =10,
category.names = c("External", "Development", "Internal"))+
scale_fill_viridis_c() +
theme(legend.position = "none")
x <- list(A = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47),
B = c(47, 48, 55), c = c(47, 48, 49))
## ggVennDiagram ####
ggVennDiagram(x,
label_alpha = 0,
color = "gray28",
lwd = 0.8, lty = 1,
label = "count",
category.names = c("External validation",
"Internal validation",
"Development")) +
scale_fill_gradient(low = "lightcyan", high = "deepskyblue4") +
guides(fill = guide_legend(title = "Title")) +
theme(legend.title = element_text(color = "gray28"),
legend.position = "bottom")
ggVennDiagram(x, category.names = c("External validation",
"Internal validation",
"Apparent validation"))
library(rJava)
install.packages("rJava")
library(rJava)
r.version()
Sys.setenv(JAVA_HOME = "/opt/homebrew/opt/openjdk/libexec/openjdk.jdk/Contents/Home")
dyn.load("/opt/homebrew/opt/openjdk/lib/server/libjvm.dylib")
install.packages("ggvenn")
library(ggvenn)
ggvenn(x, fill_color = c("gray28", "deepskyblue4", "rosybrown1"))
shapes = c(15, 17)
shapes <- shapes[as.numeric(data1$group)]
colours = c("gray28", "royalblue3", "red3")
colours <- colours[as.numeric(data1$colour)]
forest(x = data1$auc, ci.lb = data1$auc.lb, ci.ub = data1$auc.ub,
slab = data1$`author(s).and.year`,
psize = rep(1, length(data1$auc)),
xlab = "area under the curve (AUC)", refline = 0.5,
ylim = c(0.5, 100), xlim = c(-0.8, 1.25),
ilab = c(data1$samplesize), ilab.xpos = -0.1,
at = c(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1),
cex = 1.0, header = "Author(s) and Year",
pch = shapes, col = colours)
install.packages("ggvenn")
install.packages("eulerr")
library(eulerr)
vd <- euler(c(A = 3, B = 3, C = 46,
"A&B" = 2, "A&C" = 1, "B&C" = 1,
"A&B&C" = 1))
pdf("validation.venn.pdf", width = 10, height = 10)
plot(vd, quantities = TRUE)
dev.off()
vd <- euler(c(A = 3, B = 3, C = 46,
"A&B" = 2, "A&C" = 1, "B&C" = 1,
"A&B&C" = 1))
plot(vd, quantities = TRUE)
vd <- euler(c(
"Internal validation" = 3,
"Apparent validation" = 3,
"External validation" = 46,
"Internal validation&Apparent validation" = 2,
"Internal validation&External validation" = 1,
"Apparent validation&External validation" = 1,
"Internal validation&Apparent validation&External validation" = 1
))
# plot with customization
plot(vd,
quantities = list(cex = 1.5),  # Size of the numbers
labels = list(cex = 1.2),       # Size of category labels
fills = list(fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"), # Custom colors
alpha = 0.5))       # Transparency
vd <- euler(c(
"Internal validation" = 1,
"Apparent validation" = 1,
"External validation" = 46,
"Internal validation&Apparent validation" = 1,
"Internal validation&External validation" = 1,
"Apparent validation&External validation" = 1,
"Internal validation&Apparent validation&External validation" = 1
))
# plot with customization
plot(vd,
quantities = list(cex = 1.5),  # Size of the numbers
labels = list(cex = 1.2),       # Size of category labels
fills = list(fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"), # Custom colors
alpha = 0.5))       # Transparency
# plot with customization
plot(vd,
quantities = TRUE,
fills = c("Internal validation" = "#D4E6B5",
"Apparent validation" = "#A8DCD1",
"External validation" = "#C8B5E6"),
alpha = 0.5,
labels = list(labels = c("Internal validation",
"Apparent validation",
"External validation"),
pos = "outside"))  # this moves labels outside
library(VennDiagram)
install.packages("VennDiagram")
library(VennDiagram)
venn.plot <- draw.triple.venn(
area1 = 50, area2 = 7, area3 = 7,
n12 = 3, n23 = 3, n13 = 3, n123 = 1,
category = c("External validation", "Internal validation", "Apparent validation"),
fill = c("#C8B5E6", "#D4E6B5", "#A8DCD1"),
alpha = 0.5,
cex = 1.5,
cat.cex = 1.2,
rotation.degree = 90,  # Rotate the entire diagram
cat.pos = c(0, 0, 180),
cat.dist = c(0.05, 0.05, 0.05)
)
venn.plot
venn.plot <- draw.triple.venn(
area1 = 50, area2 = 7, area3 = 7,
n12 = 3, n23 = 3, n13 = 3, n123 = 1,
category = c("External validation", "Internal validation", "Apparent validation"),
fill = c("#C8B5E6", "#D4E6B5", "#A8DCD1"),
alpha = 0.5,
cex = 1.5,
cat.cex = 1.2,
rotation.degree = 90,  # Rotate the entire diagram
cat.pos = c(0, 0, 180),
cat.dist = c(0.05, 0.05, 0.05)
)
venn.plot
vd <- euler(c(
"Internal validation" = 1,
"Apparent validation" = 1,
"External validation" = 46,
"Internal validation&Apparent validation" = 1,
"Internal validation&Apparent validation&External validation" = 1
))
# plot with customization
plot(vd,
quantities = list(type = c("counts"),  # Show counts
which = vd$original.values > 0),  # Only show non-zero values
fills = c("Internal validation" = "#D4E6B5",
"Apparent validation" = "#A8DCD1",
"External validation" = "#C8B5E6"),
alpha = 0.5,
labels = list(labels = c("Internal validation",
"Apparent validation",
"External validation"),
pos = "outside"))  # this moves labels outside
# plot with customization
plot(vd,
quantities = list(type = c("counts"),  # Show counts
which = vd$original.values > 0),  # Only show non-zero values
fills = c("Internal validation" = "#D4E6B5",
"Apparent validation" = "#A8DCD1",
"External validation" = "#C8B5E6"),
alpha = 0.5,
labels = list(labels = c("Internal validation",
"Apparent validation",
"External validation"),
pos = "outside"))  # this moves labels outside
vd <- euler(c(
"Internal validation" = 1,
"Apparent validation" = 1,
"External validation" = 46,
"Internal validation&Apparent validation" = 1,
"Internal validation&Apparent validation&External validation" = 1
))
# plot with customization
plot(vd,
quantities = FALSE,  # turn off automatic quantities
fills = c("Internal validation" = "#D4E6B5",
"Apparent validation" = "#A8DCD1",
"External validation" = "#C8B5E6"),
alpha = 0.5,
labels = list(labels = c("Internal validation",
"Apparent validation",
"External validation")))
# Manually add only non-zero values
# You'll need to adjust x, y coordinates based on your plot
text(x = 0.45, y = 0.5, "1", cex = 1.5)   # Internal & Apparent & External
View(data1)
View(data2)
library(VennDiagram)
install.packages("grid")
library(grid)
venn.plot <- draw.triple.venn(
area1 = 4, area2 = 4, area3 = 49,
n12 = 2, n23 = 2, n13 = 2, n123 = 1,
category = c("Internal validation", "Apparent validation", "External validation"),
fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"),
alpha = 0.5,
cex = 2.5,
cat.cex = 1.5,
cat.default.pos = "outer",
rotation.degree = 0,        # Try rotating if needed
cat.dist = c(0.05, 0.05, 0.025)
)
venn.plot
grid.draw(venn.plot)
grid.draw(venn.plot)
grid.newpage()
grid.draw(venn.plot)
library(VennDiagram)
library(grid)
venn.plot <- draw.triple.venn(
area1 = 4, area2 = 4, area3 = 49,
n12 = 2, n23 = 2, n13 = 2, n123 = 1,
category = c("Internal validation", "Apparent validation", "External validation"),
fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"),
alpha = 0.5,
cex = 2.5,
cat.cex = 1.5,
cat.default.pos = "outer",
rotation.degree = 0,        # Try rotating if needed
cat.dist = c(0.05, 0.05, 0.025)
)
grid.newpage()
grid.draw(venn.plot)
venn.plot <- draw.triple.venn(
area1 = 4, area2 = 4, area3 = 49,
n12 = 2, n23 = 2, n13 = 2, n123 = 1,
category = c("Internal validation", "Apparent validation", "External validation"),
fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"),
alpha = 0.5,
cex = 2.5,
cat.cex = 1.5,
cat.default.pos = "outer",
rotation.degree = 90,        # Try rotating if needed
cat.dist = c(0.05, 0.05, 0.025)
)
grid.newpage()
grid.draw(venn.plot)
library(VennDiagram)
library(grid)
venn.plot <- draw.triple.venn(
area1 = 4, area2 = 4, area3 = 49,
n12 = 2, n23 = 2, n13 = 2, n123 = 1,
category = c("Internal validation", "Apparent validation", "External validation"),
fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"),
alpha = 0.5,
cex = 2.5,
cat.cex = 1.5,
cat.default.pos = "outer",
rotation.degree = 90,        # Try rotating if needed
cat.dist = c(0.05, 0.05, 0.025)
)
grid.newpage()
grid.draw(venn.plot)
library(VennDiagram)
library(grid)
venn.plot <- draw.triple.venn(
area1 = 4, area2 = 4, area3 = 49,
n12 = 2, n123 = 1,
category = c("Internal validation", "Apparent validation", "External validation"),
fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"),
alpha = 0.5,
cex = 2.5,
cat.cex = 1.5,
cat.default.pos = "outer",
rotation.degree = 90,        # Try rotating if needed
cat.dist = c(0.05, 0.05, 0.025)
)
venn.plot <- draw.triple.venn(
area1 = 4, area2 = 4, area3 = 49,
n12 = 2, n23 = 0, n13 = 0, n123 = 1,
category = c("Internal validation", "Apparent validation", "External validation"),
fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"),
alpha = 0.5,
cex = 2.5,
cat.cex = 1.5,
cat.default.pos = "outer",
rotation.degree = 90,        # Try rotating if needed
cat.dist = c(0.05, 0.05, 0.025)
)
library(VennDiagram)
library(grid)
venn.plot <- draw.triple.venn(
area1 = 4, area2 = 4, area3 = 49,
n12 = 2, n23 = 2, n13 = 2, n123 = 1,
category = c("Internal validation", "Apparent validation", "External validation"),
fill = c("#D4E6B5", "#A8DCD1", "#C8B5E6"),
alpha = 0.5,
cex = 2.5,
cat.cex = 1.5,
cat.default.pos = "outer",
rotation.degree = 90,        # Try rotating if needed
cat.dist = c(0.05, 0.05, 0.025)
)
grid.newpage()
grid.draw(venn.plot)
install.packages("venneuler")
install.packages("rJava")
library(rJava)
library(venneuler)
vd <- venneuler(c(A = 3,
B = 3,
C = 47,
"A&B" = 2,
"A&C" = 1,
"B&C" = 1,
"A&B&C" = 1))
vd$labels <- c("", "", "46")
df("validation.venn.pdf", width = 20, height = 15, pointsize = 25)
pdf("validation.venn.pdf", width = 20, height = 15, pointsize = 25)
plot(vd)
text(0.44, 0.50, "1")
text(0.38, 0.39, "1")
text(0.38, 0.59, "1")
text(0.38, 0.50, "1")
dev.off()
vd <- venneuler(c(A = 3,
B = 3,
C = 47,
"A&B" = 2,
"A&C" = 1,
"B&C" = 1,
"A&B&C" = 1))
vd$labels <- c("", "", "46")
plot(vd)
text(0.44, 0.50, "1")
text(0.38, 0.39, "1")
text(0.38, 0.59, "1")
text(0.38, 0.50, "1")
setwd("C:/Users/mayao/Dropbox/Oxford PG/coding and data analysis/Statistics and R/all tools violence")
data1 <- read.xlsx("data/Book1R.xlsx")
data1 <- read.xlsx("data/Book1R.xlsx")
shapes = c(15, 17)
shapes <- shapes[as.numeric(data1$group)]
colours = c("gray28", "royalblue3", "red3")
colours <- colours[as.numeric(data1$colour)]
forest(x = data1$auc, ci.lb = data1$auc.lb, ci.ub = data1$auc.ub,
slab = data1$`author(s).and.year`,
psize = rep(1, length(data1$auc)),
xlab = "area under the curve (AUC)", refline = 0.5,
ylim = c(0.5, 100), xlim = c(-0.8, 1.25),
ilab = c(data1$samplesize), ilab.xpos = -0.1,
at = c(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1),
cex = 1.0, header = "Author(s) and Year",
pch = shapes, col = colours)
if (!require("pacman")) install.packages("pacman")
library(pacman)
pacman::p_load(
tidyverse, # data wrangling
openxlsx, # opening excel spreadsheets
metafor, # meta-analysis / forest plots
maps, # map / spatial objects
ggplot2, # data visualisation
rJava, # for venneuler package
venneuler # venn diagram
)
shapes = c(15, 17)
shapes <- shapes[as.numeric(data2$group)]
forest(x = data2$auc, ci.lb = data2$auc.lb, ci.ub = data2$auc.ub,
slab = data2$`author(s).and.year`,
psize = rep(1, length(data2$auc)),
xlab = "area under the curve (AUC)", refline = 0.5,
ylim = c(0.5, 74), xlim = c(-0.8, 1.25),
ilab = c(data2$samplesize), ilab.xpos = -0.2,
at = c(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1),
rows = c(0, 3:10, 13:15, 18:19, 22:26, 29, 32, 35:38, 41:44, 47:48, 51, 54:57, 60:61, 64:66, 69),
cex = 1.0, header = "Author(s) and Year",
pch = shapes, col = colours)
data1 <- read.xlsx("data/data.time-risk.xlsx")
shapes = c(15, 17)
shapes <- shapes[as.numeric(data1$group)]
colours = c("gray28", "royalblue3", "red3")
colours <- colours[as.numeric(data1$colour)]
forest(x = data1$auc, ci.lb = data1$auc.lb, ci.ub = data1$auc.ub,
slab = data1$`author(s).and.year`,
psize = rep(1, length(data1$auc)),
xlab = "area under the curve (AUC)", refline = 0.5,
ylim = c(0.5, 100), xlim = c(-0.8, 1.25),
ilab = c(data1$samplesize), ilab.xpos = -0.1,
cex = 1.0, header = "Author(s) and Year",
pch = shapes, col = colours)
op <- par(cex=1.0, font=2)
text(-0.1, 99, "Sample size")
text(0.90, 99.2, "AUC")
data1 <- read.xlsx("data/data.time-risk.xlsx")
shapes = c(15, 17)
shapes <- shapes[as.numeric(data1$group)]
colours = c("gray28", "royalblue3", "red3")
colours <- colours[as.numeric(data1$colour)]
forest(x = data1$auc, ci.lb = data1$auc.lb, ci.ub = data1$auc.ub,
slab = data1$`author(s).and.year`,
psize = rep(1, length(data1$auc)),
xlab = "area under the curve (AUC)", refline = 0.5,
ylim = c(0.5, 100), xlim = c(-0.8, 1.25),
ilab = c(data1$samplesize), ilab.xpos = -0.1,
cex = 1.0, header = "Author(s) and Year",
pch = shapes, col = colours)
op <- par(cex=1.0, font=2)
text(-0.1, 99, "Sample size")
text(0.90, 99.2, "AUC")
